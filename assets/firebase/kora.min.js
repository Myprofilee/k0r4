//get accessories doc from db
db.collection("trending").onSnapshot((snapshot) => {
    fetchTrending(snapshot.docs);
});

// --------------------fetch accessories from backend --------------------
const trendingContainer = document.querySelector(".koraTrending");

const fetchTrending = (data) => {
    let html = "";
    data.forEach((doc) => {
        const product = doc.data();
        const li = `

        

    <div class="col-xl-3 col-lg-4 col-sm-6">
       <div class="card card-full card-s3">
          <div class="card-image">
            <img src="${product.img}" class="card-img" alt="art image">
          </div>
          <!-- end card-image  -->
          <div class="card-body px-0 pb-0">
             <h5 class="card-title text-truncate mb-0">
                <a href="${product.link}">${product.name}</a>
            </h5>
             <div class="card-author mb-1 d-flex align-items-center">
                <span class="me-1 card-author-by">By</span>
                <div class="custom-tooltip-wrap">
                   <a href="javascript:void(0)" class="custom-tooltip author-link">${product.author}</a>
                   <div class="card-generic custom-tooltip-dropdown" style="position: absolute; inset: auto auto 0px 0px; margin: 0px; transform: translate3d(-51px, -22.4px, 0px);" data-popper-placement="top">
                      <div class="author-action d-flex flex-wrap align-items-center mb-3">
                         <div class="flex-shrink-0 avatar">
                            <img src="${product.imgauthor}" alt="avatar"></div>
                         <div class="ms-2">
                            <span class="author-username">@canva_network</span>
                            <span class="author-follow-text">1.3k Followers</span>
                        </div>
                      </div>
                      <h6 class="author-name mb-1">Canva Network</h6>
                      <p class="author-desc smaller mb-3">Complete account of the system, and expound the actual things.</p>
                      <div class="follow-wrap mb-3">
                         <h6 class="mb-1 smaller text-uppercase">Followed by</h6>
                         <div class="avatar-group"><a href="author.html" class="avatar-group-avatar"><img src="images/thumb/avatar.jpg" alt="avatar"></a><a href="author.html" class="avatar-group-avatar"><img src="images/thumb/avatar-2.jpg" alt="avatar"></a><a href="author.html" class="avatar-group-avatar"><img src="images/thumb/avatar-3.jpg" alt="avatar"></a><a href="author.html" class="avatar-group-avatar"><img src="images/thumb/avatar-4.jpg" alt="avatar"></a><a href="author.html" class="avatar-group-avatar"><img src="images/thumb/avatar-5.jpg" alt="avatar"></a></div>
                      </div>
                      <a class="btn btn-sm bg-dark-dim">Follow</a>
                   </div>
                   <!-- end dropdown-menu -->
                </div>
                <!-- end custom-tooltip-wrap -->
             </div>
             <!-- end card-author -->
             <div class="card-price-wrap d-flex align-items-center justify-content-between">
                <div class="me-5 me-sm-2">
                    <span class="card-price-title">Harga</span>
                    <span class="card-price-number">${product.harga}</span>
                </div>

                <ul class="btns-group d-flex">
                    <li class="flex-grow-2">
                        <a href="${product.preview}" class="btn btn-sm bg-dark-dim"><i class="ri-eye-line"></i></a>
                        <a href="${product.buy}" class="btn btn-sm bg-dark-dim">Buy Now</a>
                    </li>
                </ul>
                    
             </div>
          </div>
          <!-- end card-body -->
       </div>
       <!-- end card -->
    </div>
            `;

        html += li;
    });

    trendingContainer.innerHTML = html;
};

// --------------------add to cart from frontend--------------------
function addToCart(name, price, image) {
    var user = firebase.auth().currentUser;

    if (user) {
        // User is signed in.
    } else {
        // No user is signed in.
        M.toast({ html: "Please Login or Signup" });
    }

    db.doc(`users/${user.email}`)
        .collection("usercart")
        .doc(`${name}`)
        .get()
        .then((doc) => {
            console.log(doc.exists);
            if (doc.exists) {
                M.toast({ html: "Item already added to your cart" });
            } else {
                db.doc(`users/${user.email}`)
                    .collection(`usercart`)
                    .doc(`${name}`)
                    .set({
                        useruid: user.uid,
                        name: name,
                        price: Number(price),
                        image: image,
                    })
                    .then(() => {
                        M.toast({ html: "Item added to your cart" });
                    });
            }
        });
}
